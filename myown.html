<!--                                                          En-tête                                                          -->
<div class="sheet-entete-colonne">
    <div class="sheet-entete-souscolonne">
        <!--Name & Rank-->
        <div class="sheet-entete-leftrow">
            <label class="sheet-entete">Name:</label>
            <input type="text" name="attr_character_name" class="sheet-entete" />
        </div>
        <div class="sheet-entete-leftrow">
            <label class="sheet-entete">Rank:</label>
            <input type="text" name="attr_rank" class="sheet-entete" />
        </div>
    </div>

    <div class="sheet-entete-souscolonne">
        <!--Vie & Mana-->
        <div class="sheet-entete-mainrow">
            <label class="sheet-entete-middle">Vie:</label>
            <div class="sheet-entete-middlerow">
                <input type="text" name='attr_vie' class='sheet-entete-middle'>
                <label class="sheet-slash">/</label>
                <input type="text" name='attr_vie-max' class='sheet-entete-middle' readonly>
            </div>
            <label class="sheet-entete-middle"></label>
        </div>
        <div class="sheet-entete-mainrow">
            <label class="sheet-entete-middle">Mana:</label>
            <div class="sheet-entete-middlerow">
                <input type="text" name='attr_mana' class='sheet-entete-middle'>
                <label class="sheet-slash">/</label>
                <input type="text" name='attr_mana-max' class='sheet-entete-middle' readonly>
            </div>
            <label class="sheet-entete-middle"></label>
        </div>
    </div>

    <div class="sheet-entete-souscolonne">
        <!--Setting & Race-->
        <div class="sheet-entete-rightrow">
            <label class="sheet-entete">Race:</label>
            <input type="text" name="attr_setting" class="sheet-entete" />
        </div>
        <div class="sheet-entete-rightrow">
            <label class="sheet-entete">Level:</label>
            <input type="text" name="attr_race" class="sheet-entete" />
        </div>
    </div>
</div>

<br />

<!--                                                          Mise en place des tabs                                                          -->
<div class='sheet-tabs'>
    <button type="action" name="act_attributes" class='sheet-tab'>Attributes</button>
    <button type="action" name="act_inventaire" class='sheet-tab'>Inventaire</button>
    <button type="action" name="act_competences" class='sheet-tab'>Compétences</button>
</div>
<input type='hidden' class='sheet-tabstoggle' name='attr_sheetTab' value='inventaire' />

<br />

<!--                                                          Premiere tab: Attributes                                                          -->
<div class='sheet-attributes'>
    <label class="sheet-title">Attributes</label>
    <br />
    <div class="sheet-att-colonne">
        <!-- Première rangé-->
        <div class="sheet-att-souscolonne">
            <!--Force-->
            <div class="sheet-att-row">
                <label class="sheet-att-name">Force</label>
                <input type="text" name='attr_force' value='0' class='sheet-att-value'>
                <button type='roll' name='roll_testattack' class="sheet-att-roll-button"
                    value='&{template:default} {{name=@{character_name}}} {{Force: [[@{force-result}]] | Jet: [[1d100]]}}'></button>
                <input type="number" name="attr_force-bonus" class='sheet-att-value' value="0" />
                <input type="checkbox" name="attr_force-bonus-check" checked="true" class="sheet-att-check" value="1" />
            </div>

            <!--Endurance-->
            <div class="sheet-att-row">
                <label class="sheet-att-name">Endurance</label>
                <input type="text" name='attr_endurance'value="0" class='sheet-att-value'>
                <button type='roll' name='roll_testattack' class="sheet-att-roll-button"
                    value='&{template:default} {{name=@{character_name}}} {{Endurance: [[@{endurance-result}]] | Jet: [[1d100]]}}'></button>
                <input type="number" name="attr_endurance-bonus" class='sheet-att-value' value="0" />
                <input type="checkbox" name="attr_endurance-bonus-check" checked="true" class="sheet-att-check"
                    value="1" />
            </div>
            <!--Présence-->
            <div class="sheet-att-row">
                <label class="sheet-att-name">Présence</label><input type="text" name='attr_presence' value="0" 
                    class='sheet-att-value'>
                <button type='roll' name='roll_testattack' class="sheet-att-roll-button"
                    value='&{template:default} {{name=@{character_name}}} {{Présence: [[@{presence-result}]] | Jet: [[1d100]]}}'></button>
                <input type="number" name="attr_presence-bonus" class='sheet-att-value' value="0" />
                <input type="checkbox" name="attr_presence-bonus-check" checked="true" class="sheet-att-check"
                    value="1" />
            </div>
            <!--Forge-->
            <div class="sheet-att-row">
                <label class="sheet-att-name">Arti. Rigide</label><input type="text" name='attr_forge' value="0" 
                    class='sheet-att-value'>
                <button type='roll' name='roll_testattack' class="sheet-att-roll-button"
                    value='&{template:default} {{name=@{character_name}}} {{Forge: [[@{forge-result}]] | Jet: [[1d100]]}}'></button>
                <input type="number" name="attr_forge-bonus" class='sheet-att-value' value="0" />
                <input type="checkbox" name="attr_forge-bonus-check" checked="true" class="sheet-att-check" value="1" />
            </div>
        </div>
        <!--Deuxième rangé-->
        <div class="sheet-att-souscolonne">
            <!--Intelligence-->
            <div class="sheet-att-row">
                <label class="sheet-att-name">Intelligence</label><input type="text" name='attr_intelligence' value="0" 
                    class='sheet-att-value'>
                <button type='roll' name='roll_testattack' class="sheet-att-roll-button"
                    value='&{template:default} {{name=@{character_name}}} {{Intelligence: [[@{intelligence-result}]] | Jet: [[1d100]]}}'></button>
                <input type="number" name="attr_intelligence-bonus" class='sheet-att-value' value="0" />
                <input type="checkbox" name="attr_intelligence-bonus-check" checked="true" class="sheet-att-check"
                    value="1" />
            </div>
            <br />
            <!--Magie-->
            <div class="sheet-att-row">
                <label class="sheet-att-name">Magie</label><input type="text" name='attr_magie' class='sheet-att-value' value="0" >
                <button type='roll' name='roll_testattack' class="sheet-att-roll-button"
                    value='&{template:default} {{name=@{character_name}}} {{Magie: [[@{magie-result}]] | Jet: [[1d100]]}}'></button>
                <input type="number" name="attr_magie-bonus" class='sheet-att-value' value="0" />
                <input type="checkbox" name="attr_magie-bonus-check" checked="true" class="sheet-att-check" value="1" />
            </div>
            <br />
            <!--Érudition-->
            <div class="sheet-att-row">
                <label class="sheet-att-name">Érudition</label><input type="text" name='attr_erudition' value="0" 
                    class='sheet-att-value'>
                <button type='roll' name='roll_testattack' class="sheet-att-roll-button"
                    value='&{template:default} {{name=@{character_name}}} {{Érudition: [[@{erudition-result}]] | Jet: [[1d100]]}}'></button>
                <input type="number" name="attr_erudition-bonus" class='sheet-att-value' value="0" />
                <input type="checkbox" name="attr_erudition-bonus-check" checked="true" class="sheet-att-check"
                    value="1" />
            </div>
            <br />
            <!--Alchimie-->
            <div class="sheet-att-row">
                <label class="sheet-att-name">Alchimie</label><input type="text" name='attr_alchimie' value="0" 
                    class='sheet-att-value'>
                <button type='roll' name='roll_testattack' class="sheet-att-roll-button"
                    value='&{template:default} {{name=@{character_name}}} {{Alchimie: [[@{alchimie-result}]] | Jet: [[1d100]]}}'></button>
                <input type="number" name="attr_alchimie-bonus" class='sheet-att-value' value="0" />
                <input type="checkbox" name="attr_alchimie-bonus-check" checked="true" class="sheet-att-check"
                    value="1" />
            </div>
            <br />
        </div>
        <!--Troisième rangé-->
        <div class="sheet-att-souscolonne">
            <!--Agilité-->
            <div class="sheet-att-row">
                <label class="sheet-att-name">Agilité</label><input type="text" name='attr_agilite' value="0" 
                    class='sheet-att-value'>
                <button type='roll' name='roll_testattack' class="sheet-att-roll-button"
                    value='&{template:default} {{name=@{character_name}}} {{Agilité: [[@{agilite-result}]] | Jet: [[1d100]]}}'></button>
                <input type="number" name="attr_agilite-bonus" class='sheet-att-value' value="0" />
                <input type="checkbox" name="attr_agilite-bonus-check" checked="true" class="sheet-att-check"
                    value="1" />
            </div>
            <br />
            <!--Discrétion-->
            <div class="sheet-att-row">
                <label class="sheet-att-name">Discrétion</label><input type="text" name='attr_discretion' value="0" 
                    class='sheet-att-value'>
                <button type='roll' name='roll_testattack' class="sheet-att-roll-button"
                    value='&{template:default} {{name=@{character_name}}} {{Discrétion: [[@{discretion-result}]] | Jet: [[1d100]]}}'></button>
                <input type="number" name="attr_discretion-bonus" class='sheet-att-value' value="0" />
                <input type="checkbox" name="attr_discretion-bonus-check" checked="true" class="sheet-att-check"
                    value="1" />
            </div>
            <br />

            <!--Perception-->
            <div class="sheet-att-row">
                <label class="sheet-att-name">Perception</label><input type="text" name='attr_perception' value="0" 
                    class='sheet-att-value'>
                <button type='roll' name='roll_testattack' class="sheet-att-roll-button"
                    value='&{template:default} {{name=@{character_name}}} {{Perception: [[@{perception-result}]] | Jet: [[1d100]]}}'></button>
                <input type="number" name="attr_perception-bonus" class='sheet-att-value' value="0" />
                <input type="checkbox" name="attr_perception-bonus-check" checked="true" class="sheet-att-check"
                    value="1" />
            </div>
            <br />
            <!--Ébeniste-->
            <div class="sheet-att-row">
                <label class="sheet-att-name">Arti. Souple</label><input type="text" name='attr_ebeniste' value="0" 
                    class='sheet-att-value'>
                <button type='roll' name='roll_testattack' class="sheet-att-roll-button"
                    value='&{template:default} {{name=@{character_name}}} {{Ébéniste: [[@{ebeniste-result}]] | Jet: [[1d100]]}}'></button>
                <input type="number" name="attr_ebeniste-bonus" class='sheet-att-value' value="0" />
                <input type="checkbox" name="attr_ebeniste-bonus-check" checked="true" class="sheet-att-check"
                    value="1" />
            </div>
        </div>
    </div>
</div>

<!--                                                          Deuxième tab: Inventaire                                                          -->
<div class='sheet-inventaire'>
    <div class="sheet-inv-row">
        <div>
            <div>Inventaire:</div>
            <textarea name="attr_text-slot1" class="sheet-inv-slot1"></textarea>
        </div>
        <div>
            <div>Poche Secrète:</div>
            <textarea name="attr_text-slot2" class="sheet-inv-slot2"></textarea>
        </div>
        <div>
            <div>Bourse:</div>
            <textarea name="attr_text-bourse" class="sheet-inv-bourse">000P 000G 000A 000B</textarea>
        </div>
    </div>
</div>

<!--                                                          Debug Info Box                                                          -->

<div class="sheet-debug-wrapper">
    <input type="checkbox" class="sheet-toggle-show" />

    <div class="sheet-debug">
        <div class="sheet-debug-code">
            <label class="sheet-debug-code">Debug:</label>
            <input type="text" name='attr_debug' class="sheet-debug-value" />
        </div>
        <div class="sheet-debug-code">
            <label class="sheet-debug-code">Debug WIP:</label>
            <input type="text" name='attr_debug-WIP' class="sheet-debug-value" />
        </div>
        <label class="sheet-debug-code">Version: 1.1.3</label>
    </div>
</div>

<!--                                                          Script Zone                                                          -->

<script type="text/worker">
on("sheet:opened", function(){
setAttrs({
    "debug": "00-01"
});
});
</script>

<!--Tab Script-->
<script type="text/worker">
    const buttonlist = ["attributes","inventaire","competences"];
    buttonlist.forEach(button => {
    on(`clicked:${button}`, function() {
           setAttrs({
                sheetTab: button
            });
        });
    });

</script>

<!--Multi Calcul Stat-->
<script type="text/worker">
    on("sheet:opened", function(){
        setAttrs({
            "debug": "02-01"
        });
    });
    const stats = ['force','endurance','presence','forge','intelligence','magie','erudition','alchimie','agilite','discretion','perception','ebeniste'];
    stats.forEach(function (stat) {
        on("change:" + stat + " change:" + stat + "-bonus change:" + stat + "-bonus-check sheet:opened", function () {
            setAttrs({
                "debug": "02-02"
            });
            getAttrs([stat, stat + "-bonus", stat + "-bonus-check"], function (values) {
                let var_stat = parseInt(values[stat], 10);
                let var_stat_bonus = parseInt(values[stat + '-bonus'], 10);
                let var_stat_bonus_check = parseInt(values[stat + '-bonus-check'], 10);
                if (var_stat_bonus_check == 1) {
                    setAttrs({
                        "debug": "02-03",
                        [stat + "-result"]: var_stat + var_stat_bonus
                    });
                }
                else {
                    setAttrs({
                        "debug": "02-04",
                        [stat + "-result"]: var_stat
                    });
                }
            });
        });
    });

</script>

<!--Vie & Mana Cacl-->
<script type="text/worker">
    on("change:endurance change:endurance-bonus change:magie change:magie-bonus sheet:opened", function () {
        setAttrs({
            "debug": "03-01"
        });
        getAttrs(["endurance", "endurance-bonus", "magie", "magie-bonus"], function (values) {
            let var_endurance = parseInt(values["endurance"], 10);
            let var_endurance_bonus = parseInt(values["endurance-bonus"], 10);
            let var_magie = parseInt(values["magie"], 10);
            let var_magie_bonus = parseInt(values["magie-bonus"], 10);
            setAttrs({
                "debug": "03-02",
                "vie-max": parseInt((var_endurance+var_endurance_bonus)/10)*2, 
                "mana-max": var_magie + var_magie_bonus
            })
        })
    })

</script>