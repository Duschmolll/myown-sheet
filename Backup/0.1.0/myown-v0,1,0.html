<!-- En-tête-->

<div class="3colrow">
    <div class="col">
        <label>Name:</label><input type="text" name="attr_character_name" />
        <label>Rank:</label><input type="text" name="attr_rank" />
    </div>

    <div class="col">
        <hr />
        <label class=sheet-hpmana>Vie:</label>
        <input type="text" name='attr_vie' class='sheet-short'><label class=sheet-slash>/</label>
        <input type="text" name='attr_vie_max' class='sheet-short' readonly>
        <br />
        <label class=sheet-hpmana>Mana:</label>
        <input type="text" name='attr_mana' class='sheet-short'><label class=sheet-slash>/</label>
        <input type="text" name='attr_mana_max' class='sheet-short' readonly>
        <br/>
        <input type="text" name='attr_debug' class='sheet-short'>

    </div>

    <div class="col">
        <label>Setting:</label><input type="text" name="attr_setting" />
        <label>Race:</label><input type="text" name="attr_race" />
        <hr />
    </div>

</div>
<!--Mise en place des tabs-->
<div class='sheet-tabs'>
    <button type="action" name="act_attributes" class='sheet-tab'>Attributes</button>
    <button type="action" name="act_equipement" class='sheet-tab'>Equipement</button>
    <button type="action" name="act_z" class='sheet-tab'>Z</button>
</div>
<input type='hidden' class='sheet-tabstoggle' name='attr_sheetTab' value='attributes' />

<hr />
<!--Premiere tab: Attributes-->
<div class='sheet-attributes'>
    <h2>Attributes</h2>
    <div class="3colrow">
        <!-- Première rangé-->
        <div class="col">
            <!--Force-->
            <label>Force </label><input type="text" name='attr_force' class='sheet-short'>
            <button type='roll' name='roll_testattack'
                value='&{template:default} {{name=@{character_name}}} {{Force: [[@{force-result}]] | Jet: [[1d100]]}}'></button>
            <input type="number" name="attr_force-bonus" />
            <input type="checkbox" name="attr_force-bonus-check" checked="true" class=sheet-checkbox value="1" />
            <br />
            <!--Endurance-->
            <label>Endurance </label><input type="text" name='attr_endurance' class='sheet-short'>
            <button type='roll' name='roll_testattack'
                value='&{template:default} {{name=@{character_name}}} {{Endurance: [[@{endurance-result}]] | Jet: [[1d100]]}}'></button>
            <input type="number" name="attr_endurance-bonus" />
            <input type="checkbox" name="attr_endurance-bonus-check" checked="true" class=sheet-checkbox value="1" />
            <br />
            <!--Présence-->
            <label>Présence </label><input type="text" name='attr_presence' class='sheet-short'>
            <button type='roll' name='roll_testattack'
                value='&{template:default} {{name=@{character_name}}} {{Présence: [[@{presence-result}]] | Jet: [[1d100]]}}'></button>
            <input type="number" name="attr_presence-bonus" />
            <input type="checkbox" name="attr_presence-bonus-check" checked="true" class=sheet-checkbox value="1" />
            <br />
            <!--Forge-->
            <label>Forge </label><input type="text" name='attr_forge' class='sheet-short'>
            <button type='roll' name='roll_testattack'
                value='&{template:default} {{name=@{character_name}}} {{Forge: [[@{forge-result}]] | Jet: [[1d100]]}}'></button>
            <input type="number" name="attr_forge-bonus" />
            <input type="checkbox" name="attr_forge-bonus-check" checked="true" class=sheet-checkbox
                    value="1" />
            <br />
        </div>
        <!--Deuxième rangé-->
        <div class="col">
            <!--Intelligence-->
            <label>Intelligence </label><input type="text" name='attr_intelligence' class='sheet-short'>
            <button type='roll' name='roll_testattack'
                value='&{template:default} {{name=@{character_name}}} {{Intelligence: [[@{intelligence-result}]] | Jet: [[1d100]]}}'></button>
            <input type="number" name="attr_intelligence-bonus" />
            <input type="checkbox" name="attr_intelligence-bonus-check" checked="true" class=sheet-checkbox value="1" />
            <br />
            <!--Magie-->
            <label>Magie </label><input type="text" name='attr_magie' class='sheet-short'>
            <button type='roll' name='roll_testattack'
                value='&{template:default} {{name=@{character_name}}} {{Magie: [[@{magie-result}]] | Jet: [[1d100]]}}'></button>
            <input type="number" name="attr_magie-bonus" />
            <input type="checkbox" name="attr_magie-bonus-check" checked="true" class=sheet-checkbox value="1" />
            <br />
            <!--Érudition-->
            <label>Érudition </label><input type="text" name='attr_erudition' class='sheet-short'>
            <button type='roll' name='roll_testattack'
                value='&{template:default} {{name=@{character_name}}} {{Érudition: [[@{erudition-result}]] | Jet: [[1d100]]}}'></button>
            <input type="number" name="attr_erudition-bonus" />
            <input type="checkbox" name="attr_erudition-bonus-check" checked="true" class=sheet-checkbox value="1" />
            <br />
            <!--Alchimie-->
            <label>Alchimie </label><input type="text" name='attr_alchimie' class='sheet-short'>
            <button type='roll' name='roll_testattack'
                value='&{template:default} {{name=@{character_name}}} {{Alchimie: [[@{alchimie-result}]] | Jet: [[1d100]]}}'></button>
            <input type="number" name="attr_alchimie-bonus" />
            <input type="checkbox" name="attr_alchimie-bonus-check" checked="true" class=sheet-checkbox value="1" />
            <br />
        </div>
        <!--Troisième rangé-->
        <div class="col">
            <!--Agilité-->
            <label>Agilité </label><input type="text" name='attr_agilite' class='sheet-short'>
            <button type='roll' name='roll_testattack'
                value='&{template:default} {{name=@{character_name}}} {{Agilité: [[@{agilite-result}]] | Jet: [[1d100]]}}'></button>
            <input type="number" name="attr_agilite-bonus" />
            <input type="checkbox" name="attr_agilite-bonus-check" checked="true" class=sheet-checkbox value="1" />
            <br />
            <!--Discrétion-->
            <label>Discrétion </label><input type="text" name='attr_discretion' class='sheet-short'>
            <button type='roll' name='roll_testattack'
                value='&{template:default} {{name=@{character_name}}} {{Discrétion: [[@{discretion-result}]] | Jet: [[1d100]]}}'></button>
            <input type="number" name="attr_discretion-bonus" />
            <input type="checkbox" name="attr_discretion-bonus-check" checked="true" class=sheet-checkbox value="1" />
            <br />
            <!--Perception-->
            <label>Perception </label><input type="text" name='attr_perception' class='sheet-short'>
            <button type='roll' name='roll_testattack'
                value='&{template:default} {{name=@{character_name}}} {{Perception: [[@{perception-result}]] | Jet: [[1d100]]}}'></button>
            <input type="number" name="attr_perception-bonus" />
            <input type="checkbox" name="attr_perception-bonus-check" checked="true" class=sheet-checkbox value="1" />
            <br />
            <!--Ébeniste-->
            <label>Ébéniste </label><input type="text" name='attr_ebeniste' class='sheet-short'>
            <button type='roll' name='roll_testattack'
                value='&{template:default} {{name=@{character_name}}} {{Ébéniste: [[@{ebeniste-result}]] | Jet: [[1d100]]}}'></button>
            <input type="number" name="attr_ebeniste-bonus" />
            <input type="checkbox" name="attr_ebeniste-bonus-check" checked="true" class=sheet-checkbox value="1" />
            <br />
        </div>
    </div>

</div>
<!--Deuxième tab: Equipement-->
<div class='sheet-equipement'>
    <div class="2colrow">

        <div class="col">
            <h2>Skills</h2>

            <fieldset class="repeating_skills">
                <select name="attr_dtype" class="dtype">
                    <option value="d4">d4</option>
                    <option value="d6">d6</option>
                    <option value="d8">d8</option>
                    <option value="d10">d10</option>
                    <option value="d12">d12</option>
                    <option value="d20">d20</option>
                    <option value="d100">d100</option>
                </select>
                <input type="text" name="attr_skillname" />
            </fieldset>

        </div>

        <div class="col">
            <h2>Derived Stats</h2>
            <div class="stats">
                <h3>Base</h3>
                <h3>Max</h3>
                <label>Pace</label><input type="text" name="attr_pace" /><input type="text" name="attr_pace_max" />
                <label>Parry</label><input type="text" name="attr_parry" /><input type="text" name="attr_parry_max" />
                <label>Toughness</label><input type="text" name="attr_toughness" /><input type="text"
                    name="attr_toughness_max" />
                <label>Charisma</label><input type="text" name="attr_charisma" /><input type="text"
                    name="attr_charisma_max" />
            </div>
        </div>

        <div class="col">

            <h2>Hindrances</h2>

            <textarea name="attr_hindrances"></textarea>

            <hr />

            <h2>Edges</h2>

            <textarea name="attr_edges"></textarea>

        </div>
        <div class='sheet-z'></div>
    </div>
</div>

<!--Script Zone-->

<!--Debug Start-->
<script type="text/worker">
on("sheet:opened", function(){
    setAttrs({
        "debug": "00-01"
    });
});
</script>

<!--Tab Script-->
<script type="text/worker">
    const buttonlist = ["attributes","equipement","z"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });
</script>

<!--Multi Calcul Stat-->
<script type="text/worker">
on("sheet:opened", function(){
    setAttrs({
        "debug": "02-01"
    });
});
const stats = ['force','endurance','presence','forge','intelligence','magie','erudition','alchimie','agilite','discretion','discretion','perception','ebeniste'];
stats.forEach(function (stat) {
    on("change:" + stat + " change:" + stat + "-bonus change:" + stat + "-bonus-check sheet:opened", function () {
        setAttrs({
                    "debug": "02-02"
                });
        getAttrs([stat,stat+"-bonus",stat+"-bonus-check"], function (values) {
            let var_stat = parseInt(values[stat], 10);
            let var_stat_bonus = parseInt(values[stat+'-bonus'], 10);
            let var_stat_bonus_check = parseInt(values[stat+'-bonus-check'], 10);
            if (var_stat_bonus_check == 1) {
                setAttrs({
                    "debug": "02-03",
                    [stat+"-result"]: var_stat + var_stat_bonus
                });
            }
            else {
                setAttrs({
                    "debug": "02-04",
                    [stat+"-result"]: var_stat 
                });
            }
        });        
    });
});

</script>
